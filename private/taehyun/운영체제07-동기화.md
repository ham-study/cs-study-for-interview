## 공유자원, 경쟁상태, 임계구역

**공유 자원**

둘 이상의 프로세스가 공유하는 자원

**경쟁상태**

경쟁 상태란 여러 프로세스가 공유 데이터를 동시에 접근할 때 공유 데이터에 대한 실행 순서에 따라 결과값이 달라지는 상황이다. 경쟁 상태는 상호배제를 안 했을 때 나타날 수 있다.

데이터를 공유하는 상황에서 문제를 방지하는 핵심은 둘 이상의 프로세스가 동시에 공유 데이터에 읽기 쓰기를 수행하지 못하도록 막는 것이다.

**임계구역**

프로세스들이 공유 메모리에 접근하는 코드 영역을 임계구역이라 한다.

임계구역 문제를 해결하기 위한 조건

1. 두 개 이상의 프로세스가 임계구역 내에 존재하지 않아야 한다. (상호배제)
2. 임계 영역에 들어간 프로세스가 없는 상태에서 들어가려 하는 프로세스가 여러개라면 어느 것이 들어갈지 결정해줘야 한다.
3. 임계구역에 진입하기 위해 무한히 기다리는 프로세스는 없어야 한다.

## 피터슨 알고리즘

1. 프로세스 0이 임계 구역에 진입하기 위해 enter_region을 호출한다.
2. 이 프로세스는 interested[0] 배열 변수를 TRUE로 하고 turn을  0으로 설정하여 자신이 임계구역에 진입하고 싶어함을 표시한다.
3. 프로세스 0은 임계구역에 진입한다.
4. 이제 프로세스 1이 enter_region을 호출한다.
5. 프로세스 1은 interested[0]이 FALSE가 될 때까지 기다려야한다.

이제 두 프로세스가 거의 동시에 enter_region을 호출하는 경우를 보자. 누구의 변수 값 변경이 늦게 수행되었는지가 중요한데, 처음 값이 다음 변경에 의해 덮어써지기 때문이다. 만약 프로세스 1이 마지막에 변경하여 turn이 1이 된다면, 프로세스 0은 대기하지 않고 바로 임계구역에 들어간다. (프로세스1의 경우 프로세스0의 interested[0]이 TRUE이기 때문에 대기해야한다)

결과적으로 이 방법은 프로세스가 임계구역에 진입하려고 하면 먼저 진입이 허용되는지 검사한다. 허용되지 않으면 허용될 때까지 제자리에서 루프를 돈다. 이 기법은 CPU 시간을 낭비할 뿐 아니라 우선순위 역전 문제가 발생할 수 있다.

## 뮤텍스

뮤텍스는 세마포어의 갯수를 세는 능력이 필요 없는 세마포어의 단순한 버전이다.

임계 구역에 들어가기 전에 반드시 Lock을 획득 해야하고, 임계영역에서 나올 때 Lock을 반환하는 방법이다. 뮤텍스는 락이 풀릴 때까지 CPU를 점유하지 않고 컨텍스트 스위칭을 실행한다. 그리고 락이 해지될 때 다수의 프로세스들이 하나의 뮤텍스에 대기 중이면 이들 중 하나가 임의로 선택되어 락을 획득한다.

## 세마포어

세마포어는 리소스의 상태를 나타내는 간단한 카운터이다. 만약 세마포어가 1보다 크다면 이 값을 감소시키고 임계구역에 진입한다. 세마포어가 0이라면 이미 제한된 수의 프로세스가 임계구역에 접근한 상태이므로 세마포어가 1이상이 될 때까지 다른 프로세스들은 대기한다.

## 모니터