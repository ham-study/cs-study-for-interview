# Servlet

<br>

## Servlet이란

- 동적 웹페이지에서 사용되는 요청/응답에 대한 자바 규격
- HTTP 요청과 응답의 흐름을 간단한 메소드 호출만으로 정의할 수 있도록 도와줌
    - 서블릿이 정의되어 있지 않다면 서비스 로직이 돌아가기 전 항상 네트워크 연결에 대한 구현을 해줘야함

### 특징

- HTML을 사용하여 response
- MVC 패턴에서의 컨트롤러 역할
- 상속 순서는 Servlet -> GenericServlet -> HttpServlet
- 스레드 단위로 동작

### 서블릿 생명주기

![](https://user-images.githubusercontent.com/71180414/131508183-005f487c-a834-4d2f-b7b5-2a849186b307.png)


1. 클래스 로더가 서블릿 클래스들을 로드함
2. 요청이 들어오면 필요한 서블릿 클래스 인스턴스를 생성
3. 생성된 서블릿 객체를 init() 메소드로 초기화
    - 한번 생성된 서블릿 객체는 싱글톤으로 계속 메모리에 남아있어 재사용됨
    - 초기화 작업에 비용이 많이 들기 때문
4. service() 메소드 호출 -> 서비스 로직 실행
5. 서블릿 컨테이너가 종료되면 destroy() 메소드를 호출


<br>

## Servlet Container

- 서블릿 객체를 관리하는 컨테이너
    - 서블릿 객체의 생명주기를 관리

### 특징

- 소켓을 구현해 스트림을 생성하여 클라이언트와 통신을 책임짐
    - request와 response 생성
- 컨테이너 로드시 스레드풀에 스레드를 만들어 놓고, 요청시 스레드를 할당함
    - 스레드는 필요한 서블릿을 호출하여 요청을 수행함
    - 원래는 요청이 들어올때 자동으로 스레드를 만들지만, 한계가 없기에 너무 많은 스레드 생성시 서버가 다운될 수 있으므로 스레드 풀 사용

### Filter

- 모든 요청이 서블릿을 들어갈때와 나갈때 거쳐가는 filter가 존재함. 
- 생명주기는 서블릿과 유사하다.
    1. 요청이 들어오면 init()으로 필터 객체 초기화
    2. doFilter()로 필터 작업 수행 -> filter chain으로 이어짐
    3. 서블릿 컨테이너가 종료되면 destroy() 메소드를 호출
- 마지막 필터에서는 서블릿 service()를 호출하고, 호출이 끝나고 나서 추가 작업 가능


<br>


## 전체 흐름

![](https://user-images.githubusercontent.com/71180414/157589010-9246b7c0-a6c8-4b10-aa8d-f5f96a26d079.png)



