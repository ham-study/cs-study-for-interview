# 프로세스

<br>

## 정의

- 실행중인 상태의 프로그램을 뜻한다.
- 스케줄링의 대상이 되는 task임
- 프로세스 내부에는 최소 하나의 스레드가 존재함
- 하드디스크의 프로그램 실행 -> 메모리 할당 -> 바이너리 코드 업로드 -> 프로세스 전환

<br>

## 구조

<img width="353" alt="image" src="https://user-images.githubusercontent.com/71180414/148102183-95b18c4b-652c-459f-82a8-1552b8535121.png">

- `text` : 컴파일된 일반 코드가 존재하는 영역
- `data` : 전역 변수나 초기화된 데이터가 존재하는 영역
- `stack` : 매개변수 지역변수 리턴 값 저장. 컴파일시 크기 결정
- `heap` : 동적 메모리를 할당 및 해제할 수 있는 영역. 런타임시 크기 결정

<br>

## 프로세스 상태

<img width="600" alt="image" src="https://user-images.githubusercontent.com/71180414/148102682-a8eddf76-cdb9-4547-9b4e-3bc7b3677ba5.png">


- `생성`(new) : 프로세스가 생성된 상태
- `준비`(ready) : 자원을 할당받기 위해 기다리는 상태
- `실행`(running) : 자원을 할당 받아 프로세스가 실행되고 있는 상태 (kernel mode)
- `대기`(wait/blocked) : 이벤트 및 I/O가 발생하여 완료될때까지 대기하는 상태
- `종료`(terminated) : 프로세스 종료됨

### 상태 전이

1. `new -> ready` : 프로세스가 생성됨과 동시에 ready 상태에서 자원할당을 기다림
2. `ready -> running` : 스케줄러가 ready 상태의 프로세스 하나를 골라(우선순위에 따라) 실행상태로 변경 
3. `running -> ready` : ready 큐에 우선순위가 높은 프로세스가 들어오면 기존 running 프로세스를 ready로 변경.
4. `running -> blocked` : 프로세스 실행 중 이벤트 및 I/O가 발생될때 변경. 이 때 ready 프로세스 하나를 실행시킴 (**문맥교환 발생**)
5. `blocked -> ready` : 이벤트가 완료된 프로세스는 ready 상태로 변경.


<br>

## 프로세스 제어 블록

### 정의

- PCB (Process Control Block)
- 커널 주소 공간의 data 영역에 존재하는 프로세스 정보 저장/관리용 자료구조
- 프로세스가 생성될때마다 해당 프로세스 고유의 PCB가 생성되고, 프로세스 종료시 삭제됨

### 역할

- 프로세스 스케줄링을 위해 데이터베이스를 관리
- 만약 running -> ready (interupt) 상황에서 프로세스가 진행하던 작업을 저장해놓지 않는다면 다시 running 상태가 되었을 때 이전에 작업했던 내용은 모두 사라지게 됨
- 따라서 running 상태의 프로세스는 작업을 수행하며 작업 진행상황(문맥,Context)을 PCB에 저장한다.

### 구조

<img width="600" alt="image" src="https://user-images.githubusercontent.com/71180414/148107171-40e6b1ea-5775-48f5-925a-1f210988aa8b.png">

- PCB에는 프로세스의 여러 정보를 저장하고 있음
- 운영체제는 PCB에 빠르게 접근하기 위해 **프로세스 테이블**을 사용한다

<br>

## 문맥 교환

- Context Switching
- CPU의 제어권이 다른 프로세스로 이양되는 과정을 뜻함
- running 상태의 프로세스가 blocked 상태로 변경되면서, ready 큐의 프로세스가 CPU를 할당받을때 발생함.
    - 시스템 콜이나 인터럽트로 인한 CPU 할당 변경은 문맥교환 아님!

<br>
<hr>
<br>

## 예상 질문

<br>

<details>
    <summary><b>프로세스에 대해 설명해주세요</b></summary>
    <br>
    프로세스는 실행상태의 프로그램을 뜻합니다.<br>
    프로그램이 실행되면 자원이 할당되고, 프로세스로 전환되며 독립적인 메모리 구조를 가지게 됩니다.<br>
    프로세스의 메모리 구조는 코드, 데이터, 힙, 스택 영역으로 나뉩니다.<br>
    코드 영역은 컴파일된 실행 가능한 코드가 저장되는 영역이고, 데이터 영역은 전역 및 정적 변수가 저장되는 영역입니다.<br>
    스택 영역은 매개변수, 지역변수, 리턴 값 등이 저장되는 영역이며, 컴파일시 크기가 결정됩니다.<br>
    힙 영역은 동적 메모리를 할당 및 해제할 수 있는 영역이며, 런타임시 크기가 결정됩니다.
</details>

<br>

<details>
    <summary><b>프로세스 상태 변화에 대해 설명해주세요</b></summary>
    <br>
    프로세스의 상태로는 생성, 준비, 실행, 대기, 종료 상태가 있습니다.<br>
    프로세스가 생성되면 생성 상태가 되고, 바로 준비 상태로 변경됩니다.<br>
    이 때 준비 대기열큐에 해당 프로세스가 추가되고, CPU 스케줄러가 준비 큐에서 우선순위가 높은 프로세스를 실행 상태로 변경시킵니다.<br>
    실행 상태의 프로세스는 CPU 자원을 할당 받아 작업을 수행하게 되고, 모든 작업이 끝나면 종료 상태로 변경됩니다.<br>
    만약 프로세스 실행 중 이벤트나 입출력 요청이 발생한다면 해당 프로세스는 잠시 대기 상태로 변경되고, 이벤트가 완료되었을 때 다시 준비 상태가 됩니다.
</details>

<br>
    
<details>
    <summary><b>PCB에 대해 설명해주세요</b></summary>
    <br>
    프로세스 제어 블록은 커널의 데이터 공간에 존재하는 프로세스 정보를 저장하는 자료구조입니다.<br>
    프로세스가 실행 상태에서 준비 상태로 변경될 때 프로세스의 작업 진행 상황을 저장해놓지 않으면 해당 프로세스가 다시 실행상태가 되었을 때 처음부터 작업을 실행해야 합니다.<br>
    따라서 프로세스가 실행될 때 작업 진행상황을 지속적으로 프로세스 제어 블록에 저장하여 프로세스 상태가 변경되어도 마지막 작업 지점부터 시작할 수 있도록 해줍니다.
</details>

<br>

<details>
    <summary><b>문맥교환에 대해 설명해주세요</b></summary>
    <br>
    문맥교환은 CPU 제어권이 다른 프로세스로 이양되는 과정을 뜻합니다.<br>
    예를 들어 프로세스가 대기 상태로 변경될 때 준비 상태의 프로세스로 CPU 제어권이 변경되게 됩니다.<br>
    이 때 문맥교환이 발생하며 대기 상태로 변경된 프로세스의 문맥을 PCB에 저장하고, 새로 실행된 프로세스의 PCB에서 문맥을 복원시킵니다.<br>
    여기서 문맥교환에 필요한 시간과 메모리를 오버헤드라 부릅니다.
</details>

<br>

