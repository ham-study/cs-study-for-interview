# 스레드 개념

## 스레드 정의

프로세스 내에서 실행되는 프로그램 흐름의 단위을 말한다.

- 프로세스가 생성되면 cpu 스케줄러는 프로세스가 해야할 일을 cpu에 전달하는데 이렇게 cpu에 전달하는 일 하나가 스레드 이다.
- `운영체제 입장`에서의 작업단위는 프로세스이고 `cpu 입장`에서의 작업 단위는 스레드이다.
- 스레드는  `프로세스 입장`에서는 프로세스의 코드에 정의된 절차에 따라 cpu에 작업 요청을 하는 실행 단위이다.
- 일이 모여 작업이 됨(스레드-프로세스)

예) 요리를 할때 한 요리사가 모든 일을 맡아서 한다면 단일 스레드, 여러 요리사가 일을 분배해서 한다면 멀티 스레드

프로세스와 스레드 차이

- 프로세스는 프로세스간 약하게 연결되어 있다(한글 프로그램-프린터)
- 스레드는 프로세스가 여러개의 스레드로 구성되므로 강하게 연결되어 있다.(한글 프로그램안에 저장, 편집)

# 멀티스레드의 구조

![](https://images.velog.io/images/pinoa1228/post/1b43f2bc-519b-4cd0-84ee-8bf68094acb6/image.png)

- 하나의 프로세스 내에는 반드시 하나 이상의 스레드가 존재하고 각 스레드는 스레드 id, 프로그램 카운터, 레지스터 집합, 스택을 독립적으로 소유한다.
- 같은 프로세스 내에서 스레드 들은 서로 코드영역 데이터 영역, 열린 파일등의 시스템 자원을 공유한다.
- 스레드 4개가 프로그램 코드상으로 현재 실행 위치가 서로 다르다는 것은 pc(프로그램 카운터→ 다음 실행될 명령어 )가 다르다는 것을 알 수 있다
- 독립적인 스택을 가지고 있는 것을 알 수 있다.


# 멀티스레드의 장단점

### 멀티 스레드 장점


- 응답성 향상: 한 스레드가 입출력으로 인해 작업이 진행되지 않더라도 다른 스레드가 작업을 계속하여 사용자의 작업 요구에 빠르게 응답할 수 있다.

- 자원공유: 한 프로세스 내에서 독립적인 스레드를 생성하면 프로세스가 가진 자원을 모든 스레드가 공유하게 되어 작업을 원활하게 진행 할 수 있다.

- 효율성 향상: 여러 개의 프로세스를 생성하는 것과 달리 멀티 스레드는 불필요한 자원의 중복을 막음 으로써 시스템의 효율이 향상 된다.

- 다중 cpu 지원: 2개 이상의 cpu를 가진 컴퓨터에서 멀티스레드를 사용하면, 다중 cpu가 멀티스레드를 동시에 처리하여 cpu 사용량이 증가하고 프로세스의 처리 시간이 단축된다.

### 멀티 스레드 단점

- 멀티 스레드의 경우 모든 스레드가 자원을 공유하기 때문에  한 스레드에 문제가 생기면 전체 프로세스에 영향을 미친다. 반면 프로세스를 여러개 만드는 방식의 경우 각 프로세스가 독립적이기 때문에 한 프로세스의 문제가 다른 프로세스로 전달되지 않는다.

# 멀티 프로세스 VS 멀티 스레드

### 멀티 프로세스


멀티 프로세스는 작업을 여러 프로세스로 분리 한 것이다. 각 프로세스는 독립된 메모리 영역을 가지고 있으며 서로 독립적으로 작동하다가 필요시, 프로세스간 통신을 통해 데이터를 주고 받는다 

**개념** 

- 하나의 프로그램을 여러개의 프로세스로 분리하여 각 프로세스가 병렬적으로 작업을 수행하는 것

**장점**

- 메모리 침범 문제를 os 차원에서 해결 할 수 있다.
- 여러 자식 프로세스 중 하나에 문제가 생겨도 다른 프로세스는 문제되지 않는다.

**단점**

- 각 프로세스가 독립된 메모리 영역을 가지고 있기 때문에 **Context switching**시 캐시, 메모리 매핑 초기화 작업들이 모두 이루어져 오버헤드가 발생한다

### 멀티 스레드

멀티 스레드는 변수나 파일 등을 공유하고 전역 변수나 함수 호출 등의 방법으로 스레드 간 통신을 한다.

**개념** 

- 하나의 프로세스에서 여러 스레드로 나누어 각 스레드가 하나의 작업을 처리하는 것

**장점**

- 메모리 공간, 시스템 자원의 효율성 증가
- data, heap 영역을 이용해 데이터를 주고 받으므로 스레드간 통신이 간단하다
- contextswitiching시 stack영역만 변경하면 되기 때문에 상대적으로 오버헤드가 적다. 이로 인해 시스템 처리량이 향상되고 프로그램 응답 시간이 단축된다.

**단점**

- 서로 다른 스레드가 스택을 제외한 메모리 공간을 공유하기 때문에 동기화 문제가 발생할 수 있다.
- 하나의 스레드에 문제가 생기면, 전체 프로세스가 영향을 받는다.