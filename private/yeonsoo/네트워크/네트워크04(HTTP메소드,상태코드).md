## HTTP

인터넷에서 데이터를 주고 받을 수 있는 프로토콜로 클라이언트에서 요청을 하면 서버는 해당 요청사항에 맞는 결과를 찾아서 클라이언트에게 응답하는 방식으로 동작합니다.

### HTTP 특징

- TCP/IP를 이용하는 프로토콜
    - HTTP3→ UDP
- 무상태 프로토콜
    - 무상태성으로 인해 서버는 클라이언트를 식별할 수 없다.→ 매번 새로운 인증을 해야하는 번거로움이 발생한다.
    - 해결 방법: 세션, 쿠키
- 비연결성
    - 클라이언트와 서버가 한번 연결을 맺은 후 클라이언트 요청에 대해 서버가 응답을 마치면 맺었던 연결을 끊어 버리는 성질을 말한다.
    - HTTP 지속 연결로 비연결성을 극복했다(각각의 자원들을 요청하고 자원이 들어올 때 연결을 종료하는 것이 아니라 **모든 자원에 대한 응답이 돌아온 후** 연결을 종료)
- 응답 상태코드
    - 클라이언트가 서버에 요청을 보냈을때 서버는 요청에 대한 처리 상태를 숫자로 반환한다.

### HTTP 메세지

응용계층의 데이터 단위는 메세지다.

- HTTP 메세지는 서비스를 제공하고 이용하기 위해 애플리케이션이 만든 데이터에 헤더를 붙여 캡슐화한 것이다.
- 헤더와 바디(본문- 데이터)로 구성된다.

## HTTP 메소드

- 서버가 클라이언트에게 요청을 할 때 기대하는 행동이다.

**배경**

- 리소스와 리소스 대상으로 하는 행위를 분리하기 위해 만들어 졌다.
- ex) 회원 CRUD API를 만든다
    - 리소스: 회원/ 행위: CRUD
    - 같은 회원이라는 리소스에서 CRUD라는 행위를 구분하기 위해 HTTP 메소드를 사용한다.

### GET

- 리소스를 조회한다.
- 서버에 전달하고 싶은 데이터는 쿼리(쿼리 파라미터, 쿼리 스트링)를 통해서 전달
- 바디를 사용해서 데이터를 전달할 수 있지만, 지원하지 않는 곳이 많아서 권장하지 않는다.
- 캐싱이 가능하여 여러번 요청시 저장된 데이터를 사용하여 POST보다 빠를 수 있다.
- 호출해도 리소스를 변경하지 않는다.(GET)

### POST

- 메세지 바디를 통해 서버로 요청하고 데이터를 전달한다.
- 주로 전달된 데이터로 신규 리소스 생성하는데 사용된다.
- 멱등하지 않다.
- POST는 GET과 비교 했을 때 URL에 데이터 정보가 들어 있지 않아 조금 더 안전하다고 할 수 있다.

### PUT

- 리소스를 대체하거나  해당 리소스가 없으면 생성한다.→ 덮어버림
- 클라이언트가 리소스를 식별한다→ post는 url의 전체 경로를 모르지만 put은 클라이언트가 리소스 위치를 알고 URL을 지정한다.
    - PUT /members/100
    - POST/members
- 리소스가 있는 경우
    - member/100이라는 리소스 위치에 리소스가 있다면, 그 위치에 리소스를 대체한다.


- 리소스가 없는 경우
    - 리소스가 없으면 그 위치에 신규 리소스가 생성된다.
    - member/100 경로에 있는 데이터와 같은 형태로 요청을 하지 않으면 리소스가 없다고 판단하고 완전히 대체한다.
    - 만약에 부분만 변경하고 싶다면 PACTH를 사용해야한다.



### PATCH

- 리소스 부분 변경
- PATCH 지원하지 않는 경우 POST를 사용하면 된다.


### DELETE

- 리소스 삭제

### **멱등성(f(f(x))=f(x))**

- 계속해서 호출해도 결과가 똑같다.
- 멱등 메소드
    - GET: 계속해서 조회해도 같은 결과가 조회된다.
    - PUT: 결과를 대체한다. 따라서 같은 요청을 여러번 해도 최종 결과는 같다.
    - DELETE: 결과를 삭제한다. 같은 요청을 여러번 해도 삭제된 결과는 똑같다.
- POST: 멱등이 아니다! 두번 호출하면 같은 결제가 중복해서 발생할 수 있다.
- 자동 복구 메커니즘에 사용된다.
- 멱등은 외부 요인으로 중간에 리소스가 변경되는 것 까지는 고려하지는 않는다.
    
    

## HTTP 상태코드

- 클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능
- 1XX: 요청이 수신되어 처리중→ 거의 사용되지 않음
- 2XX: 요청 정상처리
- 3XX(Redirection): 요청을 완료하려면 추가 행동이 필요
- 4XX: 클라이언트 오류, 잘못된 문법등으로 서버가 요청을 수행할 수 없음
- 5XX: 서버 오류, 서버가 정상 요청을 처리하지 못함

### 새로운 상태코드가 나타나면

- 클라이언트가 인식할 수 없는 상태코드를 서버가 반환하면 클라이언트는 상위 상태코드로 해석해서 처리한다. 따라서 미래에 새로운 상태 코드가 추가 되어도 클라이언트를 변경하지 않아도 된다.
- 299→ 2XX / 451→4XX

### 2XX

클라이언트의 요청을 성공적으로 처리

**200OK**

- 요청 성공

**201Created**

- 요청 성공해서 새로운 리소스가 생성됨
- 헤더의 Location에 생성된 리소스의 url을 넣어서 응답해준다.



**202 Accepted**

- 요청이 접수되었으나 처리가 완료되지 않았다.
- 배치처리 같은 곳에서 사용
- ex) 요청 접수후 1시간 뒤에 배치 프로세스가 요청을 처리한다.

**204 No Content**

- 서버가 요청을 성공적으로 수행했지만, 응답 body에 보낼 데이터가 없다.
- ex) 웹 문서 편집기의 save 버튼
    - save 버튼의 결과로 아무 내용이 없어도 된다.
    - save 버튼을 눌러도 같은 화면을 유지해야 한다.
    - 결과 내용이 없어도 204 메세지 만으로 성공을 인식할 수 있다.

### 3XX

요청을 완료하기 위해 클라이언트 프로그램의 추가 조치가 필요하다.

**리다이렉션**

- 웹 브라우저는 3XX 응답 결과에 **Location 헤더가 있으면 Location위치로** 자동 이동한다.



1. 영구 리다이렉션: 특정 리소스의 url가 영구적으로 이동(301,308)
    1. 원래의 url을 사용하지 않는다.
    2. 검색 엔진등에서도 변경을 인지할 수 있다. 
    
    **301 Moved Permanently**
    
    - 리다이렉트 요청 메소드가 GET으로 변하고, 본문이 제거될 수 있음(대부분)
    - 등록하려고 했던 것을 다시 작성해야한다, 같은 등록 폼이 응답으로 온다.
    
    → 308로 해결 가능
    
   
    
    **308 Permanent Redirect**
    
    - 301과 기능은 같다
    - 리다이렉트시 요청 메소드와 본문 유지(POST로 보내면 리다이렉트도 POST)
    
  
2. 일시 리다이렉션: 리소스의 url이 일시적인 변경된다.
    1. 검색엔진 등에서 URL을 변경하면 안된다.
    2. ex)주문 완료 후 주문 내역 화면으로 이동
    
    **302 Found**
    
    - 리다이렉트 시 요청 메소드가 GET으로 변하고 본문이 제거될 수 있다.
    - 대부분 302를 사용한다.
    
    **307 Temporary Redirect**
    
    - 302와 기능은 같다
    - 리다이렉트시 요청메소드와 **본문 유지**(요청 메소드를 변경하면 안된다.)
    
    **303 See Other**
    
    - 302와 기능은 같다
    - 리다이렉트시 요청 메소드가 무조건 **GET으로 변경된다.**
    
    → 스펙상 307과 303을 권장하지만 302를 대부분 사용한다. GET으로 메소드를 변경해도 상관이 없으면 302를 사용한다.
    
    **PRG(Post/Redirect/Get)**
    
    - POST로 요청후 새로고침을 하면 멱등하지 않은 특징 때문에 여러개의 요청으로 의도 하지 않는 리소스들이 생길 수 있다. 따라서 302,303을 사용하여 리다이렉션시 메소드가 GET으로 변경되게 하여 해결한다.
    
    ex) POST로 주문 후 웹 브라우저를 새로 고침 하면 다시 요청해서 중복 주문이 될 수 있다.
    
    → 결과 화면에서 새로고침하면 같은 URL에서 한번더 POST요청을 처리하게 되어 중복 요청이 들어간다.
    

    

**해결**

1. POST로 주문후에 응답 상태 코드를 302로 주어 주문 결과 화면을 GET 메소드로 리다이렉트한다.
2. 새로고침시 결과 화면을 GET으로 조회 하여 중복 주문을 막을 수 있다.



3.  특수 리다이렉션

**300 Multiple Choices**

- 거의 안씀

**304 Not Modified**

- 캐시를 목적으로 사용
- 클라이언트에 리소스가 수정되지 않았음을 알려준다. 따라서 클라이언트는 로컬PC에 저장된 캐시를 재사용한다. →캐시로 리다이렉트 한다.
- 로컬 캐시를 사용해야하기 때문에 304 응답은 응답에 메세지 바디를 포함하면 안된다
- 조건부 GET요청시 사용한다.

### 4XX

- 클라이언트 오류→ 오류 원인이 클라이언트에 있다
- 클라이언트가 잘못된 요청이기 때문에 재시도 해도 실패한다→ 반면 500은 서버가 복구되면 성공한다.

**400 Bad Request**

- 클라이언트가 잘못된 요청을 해서 서버가 요청을 처리할 수 없다.
- 요청 구문이나 메세지에 오류가 있는 경우이다. 따라서 클라이언트는 요청 내용을 다시 검토하고 보내야한다
- ex) 요청 파라미터가 잘못되거나 API 스펙이 맞지 않을때

**401 Unauthorized**

- 클라이언트가 해당 리소스에 대한 인증이 필요하다
- 인증 되지 않음
- 응답에 WWW-Authenticate 헤더와 함께 인증 방법을 설명한다.

**403 Forbidden**

- 서버가 요청을 이해 했지만 승인을 거부함
- 접근 권한이 불충분한 경우 사용한다.
- ex) 어드민이 아닌 사용자가 로그인은 했지만 어드민 권한 리소스에 접근하는 경우

**404 Not Found**

- 요청 리소스를 찾을 수 없다
- 요청 리소스가 서버에 없거나 클라이언트가 권한이 부족한 리소스에 접근 할 때, 403을 내리지 않고 해당 리소스를 숨기고 싶을때

### 5XX

- 서버 오류
- 서버에 문제가 있기 때문에 재시도 하면 성공할 수도 있다.
- 비즈니스 로직상 예외상황인 경우에는 500으로 처리하면 안된다.

**500 Internal Server Error**

- 서버 내부 문제로 오류가 발생한다.
- 애매하면 500 오류

**503 Service Unavailable**

- 서비스 이용 불가
- 서버가 일시적인 과부하 또는 예정된 작업으로 잠시 요청을 처리할 수 없음
- Retry-After 헤더 필드로 얼마뒤에 복구되는지 보낼 수 있음